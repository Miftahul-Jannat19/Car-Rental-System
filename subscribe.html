<?php session_start(); ?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Car Subscription - CARRUS</title>
  <!-- <link rel="stylesheet" href="carrusCSS/subscribe.css" /> -->
</head>
<body>
  <nav class="navbar">
    <div class="nav-links">
      <a href="./home.html">Back</a>
    </div>
  </nav>

  <div class="main-content">
    <div class="container">
      <h2>Subscribe to a Car</h2>
      <form id="subscription-form" name="subscription-form">
        <div class="form-group">
          <label for="car">Select Car</label>
          <select id="car" name="carId" required>
            <?php include('car_data.php'); ?>
          </select>
        </div>

        <div class="form-group">
          <label for="start-date">Start Date</label>
          <input type="date" id="start-date" name="startDate" required />
        </div>

        <div class="form-group">
          <label for="duration">Duration</label>
          <select id="duration" name="duration" required>
            <option value="1">1 Month</option>
            <option value="3">3 Months</option>
            <option value="6">6 Months</option>
            <option value="12">12 Months</option>
          </select>
        </div>

        <div class="form-group">
          <label for="address">Pickup Address</label>
          <input type="text" id="address" name="address" required />
        </div>

        <div class="form-group">
          <label for="driver">Need Driver?</label>
          <select id="driver" name="driver">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </div>

        <div class="form-group">
          <label for="price">Estimated Price</label>
          <input type="text" id="price" name="price" readonly />
        </div>

        <div class="form-group">
          <label for="transaction-number">Transaction Number</label>
          <input type="text" id="transaction-number" name="transaction" required />
        </div>

        <div class="form-group">
          <label for="amount">Amount</label>
          <input type="text" id="amount" name="amount" readonly />
        </div>

        <button type="submit">Pay & Subscribe</button>
      </form>
    </div>
  </div>

  <div class="container subscription-history">
    <h2>Your Subscription History</h2>
    <?php include('subscription_history.php'); ?>
  </div>

  <!-- <script>
    const MONTHLY_RATE = 8000;
    const DRIVER_SALARY = 3000;

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('duration').addEventListener('change', calculatePrice);
      document.getElementById('driver').addEventListener('change', calculatePrice);
      calculatePrice();

      document.getElementById('subscription-form').addEventListener('submit', simulatePayment);
    });

    function calculatePrice() {
      const duration = parseInt(document.getElementById('duration').value);
      const driver = document.getElementById('driver').value === 'yes';
      let total = MONTHLY_RATE * duration;
      if (driver) total += DRIVER_SALARY * duration;

      document.getElementById('price').value = total.toFixed(2);
      document.getElementById('amount').value = total.toFixed(2);
    }

    function simulatePayment(event) {
      event.preventDefault();

      const form = document.getElementById('subscription-form');
      const formData = new FormData(form);

      fetch('process_subscription.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(res => {
        if (res.success) {
          alert("Subscription successful!");
          window.location.reload();
        } else {
          alert("Failed: " + res.message);
        }
      })
      .catch(() => alert("Error occurred while processing payment."));
    }
  </script> -->
</body>
</html>
